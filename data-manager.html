<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>  转 - 拽专转 转 拽爪转转 </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Heebo', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            padding: 24px;
            margin: 16px auto;
            max-width: 1200px;
            width: 100%;
        }

        .btn {
            @apply px-5 py-2 rounded-lg font-semibold transition-all duration-300;
        }
        .btn-primary {
            @apply bg-blue-600 text-white hover:bg-blue-700;
        }
        .btn-success {
            @apply bg-green-600 text-white hover:bg-green-700;
        }
        .btn-danger {
            @apply bg-red-600 text-white hover:bg-red-700;
        }
        .btn-secondary {
            @apply bg-gray-400 text-white hover:bg-gray-500;
        }

        .table-auto {
            @apply w-full text-right;
        }
        .table-auto th, .table-auto td {
            @apply px-4 py-2 border border-gray-300;
        }
        .table-auto th {
            @apply bg-gray-100 font-semibold;
        }

        .success-message {
            @apply bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4;
        }
        .error-message {
            @apply bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4;
        }
    </style>
</head>
<body class="flex items-center justify-center">
    <div class="card p-8 shadow-lg text-right">
        <h1 class="text-4xl font-bold mb-6 text-center text-gray-800">
            <i class="fas fa-tools"></i>  转 砖转转驻
        </h1>

        <div id="messages" class="mb-4"></div>

        <section class="mb-8">
            <h2 class="text-2xl font-semibold mb-4 text-gray-700"><i class="fas fa-file-import"></i> /转 驻</h2>
            <div class="mb-4">
                <label for="phoneNumbers" class="block text-gray-700 text-lg font-medium mb-2">拽 专砖转 驻 (  砖专):</label>
                <textarea id="phoneNumbers" rows="10" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-gray-800" placeholder="050-1234567&#10;052-9876543"></textarea>
            </div>
            <div class="flex justify-center gap-4">
                <button id="processPhonesBtn" class="btn btn-primary"><i class="fas fa-cogs"></i>
                    注 驻
                </button>
                <button id="clearInputBtn" class="btn btn-secondary"><i class="fas fa-broom"></i>
                    拽 拽
                </button>
            </div>
            <p id="processedCount" class="mt-3 text-lg text-gray-700 text-center"></p>
        </section>

        <section id="participantsSection" style="display: none;">
            <h2 class="text-2xl font-semibold mb-4 text-gray-700"><i class="fas fa-users"></i> 砖转转驻 拽</h2>
            <div class="overflow-x-auto mb-4">
                <table class="table-auto border-collapse">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>砖</th>
                            <th>驻</th>
                            <th>驻注转</th>
                        </tr>
                    </thead>
                    <tbody id="participantsTableBody">
                        </tbody>
                </table>
            </div>
            <div class="flex justify-center gap-4">
                <button id="addManuallyBtn" class="btn btn-success"><i class="fas fa-user-plus"></i>
                    住祝 转
                </button>
                <button id="saveDataBtn" class="btn btn-primary"><i class="fas fa-save"></i>
                    砖专 转
                </button>
                <button id="resetDataBtn" class="btn btn-danger"><i class="fas fa-trash-alt"></i>
                    驻住  (拽 砖转转驻)
                </button>
            </div>
        </section>

        <section id="manualAddSection" style="display: none;" class="mt-8">
            <h2 class="text-2xl font-semibold mb-4 text-gray-700"><i class="fas fa-user-plus"></i> 住驻转 砖转转祝 转</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label for="manualName" class="block text-gray-700 text-lg font-medium mb-2">砖:</label>
                    <input type="text" id="manualName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-gray-800" placeholder="砖 砖转转祝">
                </div>
                <div>
                    <label for="manualPhone" class="block text-gray-700 text-lg font-medium mb-2">驻:</label>
                    <input type="tel" id="manualPhone" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-gray-800" placeholder="05X-XXXXXXX">
                </div>
            </div>
            <div class="flex justify-center gap-4">
                <button id="confirmManualAddBtn" class="btn btn-success"><i class="fas fa-check-circle"></i>
                    砖专 住驻
                </button>
                <button id="cancelManualAddBtn" class="btn btn-secondary"><i class="fas fa-times-circle"></i>
                    
                </button>
            </div>
        </section>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
    <script>
        let participants = []; // 注专 砖 转 转 砖转转驻

        // 驻拽爪 注 住驻专 驻 拽
        function processPhoneNumbers() {
            clearMessages();
            const phoneNumbersInput = document.getElementById('phoneNumbers').value;
            const lines = phoneNumbersInput.split('\n').filter(line => line.trim() !== '');

            const newParticipants = [];
            const existingPhones = new Set(participants.map(p => p.phone)); // 驻 驻转

            lines.forEach(line => {
                const parts = line.split(/[\s,]+/); // 驻爪 驻 专  驻住拽
                let name = '';
                let phone = '';

                //  驻 砖
                const phoneRegex = /^(\+972|0)?(5\d{1}|7\d{1})[-]?\d{3}[-]?\d{4}$/; // 转 专 驻专
                for (const part of parts) {
                    const cleanPart = part.replace(/\D/g, ''); // 拽 转  住驻专
                    if (phoneRegex.test(cleanPart) || phoneRegex.test(`0${cleanPart}`)) { // 住 转  注 0 转
                        phone = cleanPart;
                    } else if (part.trim() !== '') {
                        name += (name ? ' ' : '') + part.trim();
                    }
                }

                //   爪 砖 拽, 砖转砖 驻 专专转  ( ID)
                if (!name && phone) {
                    name = `砖转转祝 ${phone}`;
                } else if (!name && !phone) {
                    //    砖  驻,  注 砖专
                    console.warn(`Skipping invalid line: ${line}`);
                    return;
                }

                if (phone && !existingPhones.has(phone)) {
                    // 爪专转 ID 
                    const newId = participants.length > 0 ? Math.max(...participants.map(p => p.id)) + 1 : 1;
                    newParticipants.push({ id: newId, name: name, phone: phone, originalPhone: line.trim() });
                    existingPhones.add(phone); // 住祝 住 注转 驻转 注转转 转 拽 
                } else if (phone && existingPhones.has(phone)) {
                    showMessage(`专: 住驻专 ${phone} 专 拽 专砖  注.`, 'warning');
                } else {
                     showMessage(`专:  转 注 转 砖专: "${line}" (住专 驻 转拽).`, 'warning');
                }
            });

            if (newParticipants.length > 0) {
                participants = [...participants, ...newParticipants]; // 住祝 转 砖 拽
                updateParticipantsTable();
                showMessage(`住驻 ${newParticipants.length} 砖转转驻 砖 爪!`, 'success');
                document.getElementById('phoneNumbers').value = ''; // 拽 转 转转 拽住
            } else if (lines.length > 0) {
                 showMessage(' 住驻 砖转转驻 砖. 转 砖 专 拽  砖拽  转拽.', 'info');
            }
            updateProcessedCount();
            document.getElementById('participantsSection').style.display = 'block';
        }

        // 驻拽爪 注 转 砖转转驻
        function updateParticipantsTable() {
            const tableBody = document.getElementById('participantsTableBody');
            tableBody.innerHTML = ''; // 拽 转  驻 注

            if (participants.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="4" class="text-center text-gray-500"> 砖转转驻 爪.</td></tr>';
                return;
            }

            participants.forEach(p => {
                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td class="border px-4 py-2">${p.id}</td>
                    <td class="border px-4 py-2">${p.name}</td>
                    <td class="border px-4 py-2">${p.phone}</td>
                    <td class="border px-4 py-2">
                        <button onclick="editParticipant(${p.id})" class="btn btn-secondary text-sm ml-2 mb-1"><i class="fas fa-edit"></i> 注专</button>
                        <button onclick="removeParticipant(${p.id})" class="btn btn-danger text-sm mb-1"><i class="fas fa-trash-alt"></i> 拽</button>
                    </td>
                `;
            });
        }

        // 驻拽爪 注专转 砖转转祝
        function editParticipant(id) {
            const participant = participants.find(p => p.id === id);
            if (!participant) {
                showMessage('砖转转祝  爪.', 'error');
                return;
            }

            const newName = prompt(`注专 砖 注专 ${participant.name}:`, participant.name);
            if (newName !== null && newName.trim() !== '') {
                participant.name = newName.trim();
            }

            const newPhone = prompt(`注专 驻 注专 ${participant.phone}:`, participant.phone);
            if (newPhone !== null && newPhone.trim() !== '') {
                participant.phone = newPhone.trim().replace(/\D/g, ''); // 拽 转  住驻专
            }

            updateParticipantsTable();
            showMessage('驻专 砖转转祝 注.', 'success');
            saveData(); // 砖专 转 专 注专
        }

        // 驻拽爪 拽转 砖转转祝
        function removeParticipant(idToRemove) {
            if (confirm(` 转  砖专爪 拽 转 砖转转祝 ID: ${idToRemove}?`)) {
                participants = participants.filter(p => p.id !== idToRemove);
                updateParticipantsTable();
                updateProcessedCount();
                showMessage(`砖转转祝 ID ${idToRemove} 拽.`, 'success');
                saveData(); // 砖专 转 专 拽
            }
        }

        // 驻拽爪 住驻 转
        function showManualAddSection() {
            document.getElementById('manualAddSection').style.display = 'block';
            document.getElementById('manualName').value = '';
            document.getElementById('manualPhone').value = '';
        }

        function cancelManualAdd() {
            document.getElementById('manualAddSection').style.display = 'none';
        }

        function confirmManualAdd() {
            clearMessages();
            const name = document.getElementById('manualName').value.trim();
            const phone = document.getElementById('manualPhone').value.trim().replace(/\D/g, ''); // 拽 转  住驻专

            if (!name || !phone) {
                showMessage('砖 驻  砖转 .', 'error');
                return;
            }

            // 爪专转 ID 
            const newId = participants.length > 0 ? Math.max(...participants.map(p => p.id)) + 1 : 1;
            const newParticipant = { id: newId, name: name, phone: phone };

            participants.push(newParticipant);
            updateParticipantsTable();
            updateProcessedCount();
            showMessage(`${name} 住祝 转 爪!`, 'success');
            cancelManualAdd(); // 住转专 转 驻住 住驻 转
            saveData(); // 砖专 转 专 住驻 转
        }


        // 驻拽爪 砖专转 转 -LocalStorage
        function saveData() {
            localStorage.setItem('tehillim_participants', JSON.stringify(participants));
            showMessage('转 砖专 爪 专 拽 砖 驻驻.', 'success');
        }

        // 驻拽爪 驻住  转
        function resetAllData() {
            if (confirm(' 转  砖专爪 拽 转  砖转转驻? 驻注   转转 !')) {
                participants = [];
                localStorage.removeItem('tehillim_participants');
                localStorage.removeItem('tehillim_reading_status'); // 拽转 转 拽专  
                updateParticipantsTable();
                updateProcessedCount();
                document.getElementById('phoneNumbers').value = ''; // 拽 转 转转 拽
                document.getElementById('participantsSection').style.display = 'none';
                showMessage(' 转 砖转转驻 拽专 拽 爪!', 'success');
            }
        }

        // 驻拽爪 注 住驻专转 砖转转驻 注
        function updateProcessedCount() {
            document.getElementById('processedCount').textContent = `住": ${participants.length} 砖转转驻`;
        }

        // 驻拽爪 爪转 注转
        function showMessage(text, type) {
            const messagesDiv = document.getElementById('messages');
            const messageClass = type === 'error' ? 'error-message' : 
                                 type === 'success' ? 'success-message' :
                                 'bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded relative mb-4'; // Added 'info' styling
            
            const messageDiv = document.createElement('div');
            messageDiv.className = messageClass;
            messageDiv.textContent = text;
            
            messagesDiv.appendChild(messageDiv);
            
            // 住专转 注 专 5 砖转
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }

        function clearMessages() {
            document.getElementById('messages').innerHTML = '';
        }

        // 注转 转 拽  砖
        window.onload = function() {
            const savedData = localStorage.getItem('tehillim_participants'); // 砖 砖 驻转
            if (savedData) {
                try {
                    participants = JSON.parse(savedData);
                    if (participants.length > 0) {
                        updateParticipantsTable();
                        document.getElementById('participantsSection').style.display = 'block';
                        updateProcessedCount(); // 注 住驻专 专 注
                        showMessage(`注 ${participants.length} 砖转转驻 拽 专 拽.`, 'info');
                        
                        // 爪转 驻 转转 拽住
                        const phoneText = participants.map(p => p.originalPhone || p.phone).join('\n');
                        document.getElementById('phoneNumbers').value = phoneText;
                    }
                } catch (e) {
                    console.error("Error loading participants from localStorage:", e);
                    showMessage("砖 注转 转 砖转转驻 拽. 转 驻住.", "error");
                    participants = []; // 驻住 拽专 砖 砖转 JSON
                    localStorage.removeItem('tehillim_participants'); // 拽 转 驻
                }
            }
        };

        // 专注
        document.getElementById('processPhonesBtn').addEventListener('click', processPhoneNumbers);
        document.getElementById('clearInputBtn').addEventListener('click', () => {
            document.getElementById('phoneNumbers').value = '';
            clearMessages();
        });
        document.getElementById('saveDataBtn').addEventListener('click', saveData);
        document.getElementById('resetDataBtn').addEventListener('click', resetAllData);
        document.getElementById('addManuallyBtn').addEventListener('click', showManualAddSection);
        document.getElementById('cancelManualAddBtn').addEventListener('click', cancelManualAdd);
        document.getElementById('confirmManualAddBtn').addEventListener('click', confirmManualAdd);

    </script>
</body>
</html>
